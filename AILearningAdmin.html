<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Learning Admin - Course Pricing</title>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { "primary": "#D0BB95", "primary-hover": "#c4a97a" },
                    fontFamily: { "display": ["Lexend", "sans-serif"] }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Lexend', sans-serif;
        }

        .input-field {
            transition: all 0.2s;
        }

        .input-field:focus {
            box-shadow: 0 0 0 3px rgba(208, 187, 149, 0.3);
        }
    </style>
</head>

<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen text-white">
    <!-- Header -->
    <header class="bg-slate-900/50 backdrop-blur-md border-b border-slate-700 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
                    <span class="material-symbols-outlined text-slate-900">school</span>
                </div>
                <div>
                    <h1 class="text-xl font-bold">AI Learning Admin</h1>
                    <p class="text-sm text-slate-400">Manage course pricing & durations</p>
                </div>
            </div>
            <a href="AIlearning.html" target="_blank"
                class="flex items-center gap-2 px-4 py-2 bg-primary text-slate-900 rounded-lg hover:bg-primary-hover transition-colors font-medium">
                <span class="material-symbols-outlined text-[18px]">open_in_new</span>
                View Live Page
            </a>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-8">
        <!-- Status -->
        <div id="status-card" class="mb-6 p-4 rounded-xl bg-amber-900/30 border border-amber-500/30 hidden">
            <p id="status-message" class="text-amber-300 font-medium flex items-center gap-2">
                <span class="material-symbols-outlined">info</span>
                <span></span>
            </p>
        </div>

        <!-- Subscription Card -->
        <div class="bg-slate-800/50 rounded-2xl border border-slate-700 overflow-hidden mb-8">
            <div class="bg-gradient-to-r from-primary to-amber-500 px-6 py-4">
                <h2 class="text-xl font-bold text-slate-900">ðŸŽ« All Access Subscription</h2>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-400">Price (â‚¹)</label>
                        <input type="number" id="sub-price"
                            class="input-field w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl focus:border-primary focus:outline-none text-xl font-bold"
                            placeholder="4999">
                    </div>
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-400">Period</label>
                        <select id="sub-period"
                            class="input-field w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded-xl focus:border-primary focus:outline-none">
                            <option value="year">Per Year</option>
                            <option value="month">Per Month</option>
                            <option value="lifetime">Lifetime</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="saveSubscription()"
                            class="w-full px-6 py-3 bg-primary text-slate-900 font-bold rounded-xl hover:bg-primary-hover transition-colors">
                            Save Subscription
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Courses Section -->
        <div class="mb-6 flex items-center justify-between">
            <h2 class="text-2xl font-bold flex items-center gap-2">
                <span class="material-symbols-outlined text-primary">menu_book</span>
                Course Pricing
            </h2>
            <button onclick="fetchConfig()"
                class="flex items-center gap-2 px-4 py-2 bg-slate-700 rounded-lg hover:bg-slate-600 transition-colors">
                <span class="material-symbols-outlined text-[18px]">refresh</span>
                Refresh
            </button>
        </div>

        <div id="courses-container" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Course cards will be loaded here -->
        </div>
    </main>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50"></div>

    <script>
        const BACKEND_URL = 'http://localhost:8080/api/ailearning-config';
        let coursesData = [];

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `flex items-center gap-2 px-4 py-3 rounded-lg shadow-lg ${type === 'success' ? 'bg-green-600' : 'bg-red-600'} text-white animate-pulse`;
            toast.innerHTML = `<span class="material-symbols-outlined">${type === 'success' ? 'check_circle' : 'error'}</span><span class="font-medium">${message}</span>`;
            document.getElementById('toast-container').appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showStatus(message) {
            document.getElementById('status-message').innerHTML = `<span class="material-symbols-outlined">info</span><span>${message}</span>`;
            document.getElementById('status-card').classList.remove('hidden');
        }

        function createCourseCard(course, index) {
            return `
                <div class="bg-slate-800/50 rounded-xl border border-slate-700 p-5" id="course-${course.id}">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <span class="text-xs font-bold text-primary uppercase tracking-wider">${course.category}</span>
                            <h3 class="text-lg font-bold mt-1">${course.name}</h3>
                        </div>
                        <span class="text-2xl font-bold text-primary">â‚¹${course.price.toLocaleString('en-IN')}</span>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="space-y-1">
                            <label class="text-xs text-slate-400 font-medium">Price (â‚¹)</label>
                            <input type="number" id="price-${course.id}" value="${course.price}"
                                class="input-field w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:border-primary focus:outline-none font-semibold">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs text-slate-400 font-medium">Duration</label>
                            <input type="text" id="duration-${course.id}" value="${course.duration}"
                                class="input-field w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:border-primary focus:outline-none">
                        </div>
                    </div>
                    <div class="space-y-1 mb-4">
                        <label class="text-xs text-slate-400 font-medium">Description</label>
                        <textarea id="desc-${course.id}" rows="2"
                            class="input-field w-full px-3 py-2 bg-slate-900 border border-slate-600 rounded-lg focus:border-primary focus:outline-none text-sm resize-none">${course.description}</textarea>
                    </div>
                    <button onclick="saveCourse('${course.id}')" 
                        class="w-full py-2 bg-primary/20 text-primary font-semibold rounded-lg hover:bg-primary/30 transition-colors border border-primary/30">
                        Save ${course.name}
                    </button>
                </div>
            `;
        }

        async function fetchConfig() {
            try {
                const response = await fetch(BACKEND_URL);
                const result = await response.json();

                if (result.success) {
                    const { subscription, courses } = result.data;
                    coursesData = courses;

                    // Update subscription fields
                    document.getElementById('sub-price').value = subscription.price;
                    document.getElementById('sub-period').value = subscription.period;

                    // Render courses
                    document.getElementById('courses-container').innerHTML =
                        courses.map((course, i) => createCourseCard(course, i)).join('');

                    document.getElementById('status-card').classList.add('hidden');
                }
            } catch (error) {
                showStatus('Backend not running. Start with: cd backend && npm start');
            }
        }

        async function saveSubscription() {
            try {
                const response = await fetch(`${BACKEND_URL}/subscription`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        price: parseInt(document.getElementById('sub-price').value),
                        period: document.getElementById('sub-period').value
                    })
                });
                const result = await response.json();
                if (result.success) {
                    showToast('Subscription updated!');
                } else {
                    showToast('Failed to update subscription', 'error');
                }
            } catch (error) {
                showToast('Backend not running', 'error');
            }
        }

        async function saveCourse(courseId) {
            try {
                const price = parseInt(document.getElementById(`price-${courseId}`).value);
                const duration = document.getElementById(`duration-${courseId}`).value;
                const description = document.getElementById(`desc-${courseId}`).value;

                const response = await fetch(`${BACKEND_URL}/course/${courseId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ price, duration, description })
                });
                const result = await response.json();
                if (result.success) {
                    showToast(`${result.data.name} updated!`);
                    fetchConfig(); // Refresh to show updated price in header
                } else {
                    showToast('Failed to update course', 'error');
                }
            } catch (error) {
                showToast('Backend not running', 'error');
            }
        }

        // Initial load
        fetchConfig();
    </script>
</body>

</html>